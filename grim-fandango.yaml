name:  Grim Fandango
game_slug: grim-fandango
version: Installer
slug: grim-fandango
runner: scummvm


script:
  files:
    - DISC1: N/A:Select grim.exe from Disc 1
    - DISC2: N/A:Select autosub.exe from Disc 2
    - patch: 
        url: https://drive.google.com/uc?export=download&id=1gfchx-coCOQhxlRL-WSdmoj6j5DgfRGX
        filename: patch.7z


  game:
    game_id: grim
    path: $GAMEDIR
  
  installer:
    - write_file:
        content: '#!/bin/bash

          src=$1

          dst=$2
          
          src_path=$(echo "$1" | sed -r "s/(.+)\/.+/\1/")

          find "$src_path" -type f \( -iname "*.lab" \) -exec cp {} "$dst" \;'

        file: $CACHE/selectcopy.sh

    - chmodx: $CACHE/selectcopy.sh

    - execute:
      file: 7z
      args: e $patch -o"$GAMEDIR" -ppassword -y

    - execute:
        args: $DISC1 $GAMEDIR
        file: $CACHE/selectcopy.sh
    
    - execute:
        file: chmod
        args: -R 775  $GAMEDIR

    - execute:
        args: $DISC2 $GAMEDIR
        file: $CACHE/selectcopy.sh
        
    - execute:
        file: chmod
        args: -R 775  $GAMEDIR

