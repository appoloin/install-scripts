name: The Feeble Files 
game_slug: the-feeble-files
version: Installer
slug:  the-feeble-files
runner: scummvm


 
script:
    game:
        game_id: feeble  
        path: $GAMEDIR

    files:
        - DISC: N/A:Select SETUP.exe from Disc 1
        - DISC2: N/A:Select Voices.wav from Disc 2
        - DISC3: N/A:Select Voices.wav from Disc 3
        - DISC4: N/A:Select Voices.wav from Disc 4


    installer:
        - write_file:
            content: '#!/bin/bash

            src="$1"

            dst="$2"
            
            src_path=$(echo "$1" | sed -r "s/(.+)\/.+/\1/")

            find "$src_path" -type f \( -iname "*.SMK" -o 
                                        -iname "*.VGA" -o 
                                        -iname "TABLES*" \) -exec cp {} "$dst" \;'
            file: $CACHE/selectcopy.sh
        - chmodx: $CACHE/selectcopy.sh

        - write_file:
            content: '#!/bin/bash

            src="$1"

            scr_file="S2"

            dst="$3"

            dst_file="$4"

            src_path=$(echo "$src" | sed -r "s/(.+)\/.+/\1/")

            find "$src_path" -type f \( -iname "scr_file" \) -exec cp {} "$dst/$dst_file" \;'
            file: $CACHE/copy&rename.sh
        - chmodx: $CACHE/copy&rename.sh

        - write_file:
            content: '#!/bin/bash

            src=$1
            
            find "$src" -maxdepth 1 -type d \( -iname drive_c -o
                                               -iname dosdevices \) -exec rm -r {}  \;
                                            
            find "$src" -maxdepth 1 -type f \( -iname "system.reg" -o
                                               -iname "user.reg" -o 
                                               -iname "userdef.reg" \) -exec rm {}  \;'
            file: $CACHE/remove.sh
        - chmodx: $CACHE/remove.sh

        - execute:
            args: $DISC Voices.wav $GAMEDIR Voices1.wav
            file: $CACHE/copy&rename.sh             
        - execute:
            args: $DISC $GAMEDIR
            file: $CACHE/selectcopy.sh  
        - execute:
            args: -R 775  $GAMEDIR
            file: /bin/chmod      
        - execute:
            args: $DISC2 Voices.wav $GAMEDIR Voices2.wav
            file: $CACHE/copy&rename.sh             
        - execute:
            args: $DISC2 $GAMEDIR
            file: $CACHE/selectcopy.sh
        - execute:
            args: -R 775  $GAMEDIR
            file: /bin/chmod
        - execute:
            args: $DISC3 Voices.wav $GAMEDIR Voices3.wav
            file: $CACHE/copy&rename.sh             
        - execute:
            args: $DISC3 $GAMEDIR
            file: $CACHE/selectcopy.sh
        - execute:
            args: -R 775  $GAMEDIR
            file: /bin/chmod
        - execute:
            args: $DISC4 Voices.wav $GAMEDIR Voices4.wav
            file: $CACHE/copy&rename.sh             
        - execute:
            args: $DISC4 $GAMEDIR
            file: $CACHE/selectcopy.sh
        - execute:
            args: -R 775  $GAMEDIR
            file: /bin/chmod

        - task:
            name: wine.create_prefix
            arch: win32
            install_mono: false
            install_gecko: false
            prefix: $GAMEDIR

        - task:
            name: wine.wineexec
            executable: $DISC
            arch: win32
            prefix: $GAMEDIR

        - execute:
            args: "'$GAMEDIR/drive_c/Program Files/AdventureSoft (UK) Ltd/The Feeble Files' '$GAMEDIR'"
            file: $CACHE/selectcopy.sh
            
        - copy:
            dst: $GAMEDIR
            src: $GAMEDIR/drive_c/Program Files/AdventureSoft (UK) Ltd/The Feeble Files/TBLLIST

        - copy:
            dst: $GAMEDIR
            src: $GAMEDIR/drive_c/Program Files/AdventureSoft (UK) Ltd/The Feeble Files/GAME22

        - copy:
            dst: $GAMEDIR
            src: $GAMEDIR/drive_c/Program Files/AdventureSoft (UK) Ltd/The Feeble Files/save.999

        - execute:
            args: $GAMEDIR
            file: $CACHE/remove.sh
