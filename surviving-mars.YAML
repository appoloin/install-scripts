name: Surviving Mars
game_slug: surviving-mars
version: Good Old Games Installer
slug: surviving-mars-INSTALLER
runner: wine
year: 2018

script:
  game:
    exe: $GAMEDIR/drive_c/GOG Games/Surviving Mars/MarsGOG.exe
    prefix: $GAMEDIR

  files:
    - setup: N/A:Select Surviving Mars installer
    - DLC2: N/A:Select Patch
    - DLC1: N/A:Select DLC

  installer:
    - task:
        name: create_prefix
        install_mono: false
        install_gecko: false
        prefix: $GAMEDIR

    - task:
        app: win7 d3dx11_43 d3dcompiler_47 
        description: 'winetricks: Direct X'
        name: winetricks
        prefix: $GAMEDIR

    - task:
        executable: $setup
        description: 'Installing Surviving Mars'
        name: wineexec
        prefix: $GAMEDIR

    # Link $DLC1 folder to Prefix DLC folder
    - execute:
        command: 'src_path=$(echo "$DLC1" | sed -r "s/(.+)\/.+/\1/");


                  ln -s -f -n "$src_path" "$GAMEDIR/drive_c/DLC"
                  '

    # DLC Mass Installer
    - write_file: 
        content: '@echo off

          REM Set the directory where the .exe files are located
                   
          C: 
          
          set FullPath="c:\dlc"

          echo %FullPath%

          REM Change to the specified directory

          cd /d %FullPath%

          REM Loop through each .exe file in the directory and run it with the /SILENT flag

          for %%f in (*.exe) do (
                
            start /wait "" "%%f" /SILENT

           )
         '
        file: $GAMEDIR/dlc_install.cmd

    - task:
        executable: $GAMEDIR/dlc_install.cmd
        name: wineexec
        prefix: $GAMEDIR

    - task:
        executable: $DLC2
        description: 'Installing Upgrade Packages'
        name: wineexec
        prefix: $GAMEDIR



  wine:
    fsync: false
    esync: false

