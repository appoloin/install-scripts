name: Heretic-ii
game_slug: heretic-ii
version: Windows Installer
slug: heretic-ii
runner: wine

script:
  game:
    args: c:\\heretic2.bat
    exe: $GAMEDIR/drive_c/windows/syswow64/wineconsole.exe
    prefix: $GAMEDIR

  installer:
    - write_file:
        content: '#!/bin/bash

          fileID=$1

          output=$2
        
          wget --load-cookies /tmp/cookies.txt 
                "https://docs.google.com/uc?export=download&confirm=
                  $(wget 
                      --quiet 
                      --save-cookies /tmp/cookies.txt 
                      --keep-session-cookies 
                      --no-check-certificate 
                      "https://docs.google.com/uc?export=download&id=$fileID" 
                       -O- | sed -rn "s/.*confirm=([0-9A-Za-z_]+).*/\1\n/p")&id=$fileID" 
                       -O $output && 
                      rm -rf /tmp/cookies.txt          
          '
        file: $CACHE/download.sh
    - chmodx: $CACHE/download.sh

    - task:
        description: Preparing Heretic II Windows CD wineprefix...
        install_gecko: false
        install_mono: false
        name: create_prefix
        prefix: $GAMEDIR

    - insert-disc:
        requires: Setup/Heretic.ico

    - extract:
        src: $DISC/Setup/zip/h2.zip
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II

    - execute:
        file: $CACHE/download.sh
        args: 1aFnFpmxU8T6IAP4kNCT2xgXU1NybxTey $CACHE/DXwND.rar

    - extract:
        file: $CACHE/DXwND.rar
        dst: $GAMEDIR/drive_c/dxwnd

    - write_config:
        data:
          target:
            cdvol0: 64
            codepage0: 0
            commitaddress0: 0
            commitlength0: 0
            coord0: 3
            country0: 0
            dflag0: 0
            dflagb0: 0
            filterid0: 0
            flag0: 673194017
            flagg0: 1207959552
            flagh0: 22
            flagi0: 138444804
            flagj0: 4224
            flagk0: 65536
            flagl0: 0
            flagm0: 65536
            flagn0: 17825796
            flago0: 0
            flagp0: 8192
            flagq0: 0
            icon0: 0000010001002020000001002000B410000016000000280000002000000040000000010020000300000080100000000000000000000000000000000000000000FF0000FF0000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000408000FF000000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000D5008080FF400000FF000040CC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B900000000000000000000000000000000000000FF000000FF000000FF000000FF00000000000000000000000000000000000000FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FF0000000000000000000000000000000000000000000040FF000000FF0000000000000000000000000000000000000000400000FF000000640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000FF004000FF0000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009A000000000000000000000000000000000000000000000000000000FF000000FF000000000000000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400080FF000000FF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FF00000000000000000000000000000000000000000000000000000000408080FF000000FF00000000000000000000000000000000000000000000000000000000000000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F600000000000000000000000000000000000000000000000000000000400080FF000000FF000000000000000000000000000000000000000000000000000000000000002000000041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080FF0000008400000000000000000000000000000000000000000000000000000000408080FF000000FF0000000000000000000000000000000000000000000000000000000000000004000000FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000080FF000000FF00000000000000000000000000000000000000000000000000000000008080FF000000FF20008020000000000000000000000000000000000000000000000000000000D1000080FF000000FF00000000000000000000000000000000000000000000000000000000000000000000000000000000008080FF000000FF400080FF000000B000000000000000000000000000000000000000FF008080FF000080FF000080FF000080FF000000FF000000B100000000000000000000000000000040000080FF008080FF000000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000BE0000000000000000000000000000000000000000000000000000000000000000000080FF008080FF000000040000000000000000000000000000000000000000000000000000000000000000000000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000204080FF000080FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080FF000080FF000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000508080FF000080FF000000280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000408080FF000080FF000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000408080FF000080FF000000290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080FF000000FF204000E30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080FF004000FF0040008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080C0FF000000FF000000FF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080FF000000000000000000000000000000000000000000000000008080FF80C0C0FF000080FF000080FF000000000000000000000000000000000000000000000000000080FF204000A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F60000000000000000000000000000000000000000000000000000000000000020000080FF000080FF400000FF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000A0FF400000FF000000FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000042008080FF400000FF404000FF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008080FF000080FF000000FF400080FF400080FF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000FF000080FF400080FF400080FF406080FF400080FF000000B000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
            initresh0: 600
            initresw0: 800
            initts0: 0
            lang0: 0
            launchpath0: C:\Program Files (x86)\Heretic II\heretic2.exe +set vid_ref glx +set vid_mode 3 +set vid_fullscreen 1
            maxddinterface0: 7
            maxfps0: 0
            maxres0: -1
            monitorid0: -1
            path0: C:\Program Files (x86)\Heretic II\heretic2.exe
            posx0: 50
            posy0: 50
            renderer0: 3
            scanline0: 0
            sizx0: 800
            sizy0: 600
            slowratio0: 2
            startfolder0: C:\Program Files (x86)\Heretic II
            swapeffect0: 0
            tflag0: 0
            title0: Heretic II
            ver0: 0
            winver0: 0
        file: $GAMEDIR/drive_c/dxwnd/dxwnd.ini

    - execute:
        file: $CACHE/download.sh
        args: 1fQvbg35j_7eOI9enFqKezIEjJRgwpXlP $CACHE/dm-maps.tar.xz

    - extract:
        src: $CACHE/dm-maps.tar.xz
        dst: $GAMEDIR/drive_c/tmp/


    - execute:
        file: $CACHE/download.sh
        args: 1nim8Y_XEvFM7pH5p9xY9lH5NmKJZvuq6 $CACHE/patch107w.7z

    - extract:
        src: $CACHE/patch107w.7z
        dst: $GAMEDIR/drive_c/tmp/


    - execute:
        file: $CACHE/download.sh
        args: 1nJiNy4kx5JVomISygBKr7AlRV_T8oKVr $CACHE/scripts.7z

    - extract:
        src: $scripts
        dst: $GAMEDIR/drive_c/tmp/
    - chmodx: $GAMEDIR/drive_c/tmp/changecase.sh
    - execute:
        file: $GAMEDIR/drive_c/tmp/changecase.sh
        args: '"drive_c/Program Files (x86)/Heretic II" "0"'

    - merge:
        src: $GAMEDIR/drive_c/tmp
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II
    - chmodx: $GAMEDIR/drive_c/tmp/h2defconf.sh
    - execute:
        file:  $GAMEDIR/drive_c/tmp/h2defconf.sh

    - input_menu:
        description: 'Please choose which language you would like to install this game:'
        id: LANG
        options:
          - keep: I prefer to use default install language
          - french: French
          - german: German
          - italian: Italian
          - spanish: Spanish
        preselect: keep

    - chmodx: $GAMEDIR/drive_c/tmp/h2local.sh
    - execute:
        file: $GAMEDIR/drive_c/tmp/h2local.sh
        args: $INPUT_LANG

    - chmodx: $GAMEDIR/drive_c/tmp/h2ws.sh
    - execute:
        file: $GAMEDIR/drive_c/tmp/h2ws.sh
        args: $RESOLUTION_WIDTH $RESOLUTION_HEIGHT

    - chmodx: $GAMEDIR/drive_c/tmp/audiotools.sh
    - execute:
        file: $GAMEDIR/drive_c/tmp/audiotools.sh
        args: HERETIC "$GAMEDIR/drive_c/Program Files (x86)/Heretic II/music" 2 flac
    
    - move:
        src: $GAMEDIR/drive_c/tmp/heretic2.bat
        dst: $GAMEDIR/drive_c
    
    - move:
        src: $GAMEDIR/drive_c/tmp/faq.html
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II
    
    - merge:
        src: $GAMEDIR/drive_c/tmp/h2_gamepad_readme.html
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II/gamepad profiles
    
    - copy:
        src: $GAMEDIR/drive_c/tmp/h2_x360.gamecontroller.amgp
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II/gamepad profiles
    
    - copy:
        src: $GAMEDIR/drive_c/tmp/h2_steam.sccprofile
        dst: $GAMEDIR/drive_c/Program Files (x86)/Heretic II/gamepad profiles
    
    - task:
        key: csmt
        name: set_regedit
        path: HKEY_CURRENT_USER\Software\Wine\Direct3D\
        prefix: $GAMEDIR
        type: REG_DWORD
        value: '00000000'
    
    - move:
        src: $GAMEDIR/drive_c/tmp/heretic2.bmp
        dst: $GAMEDIR/drive_c/
    
    - task:
        key: wallpaper
        name: set_regedit
        path: HKEY_CURRENT_USER\Control Panel\Desktop\
        prefix: $GAMEDIR
        type: REG_SZ
        value: c:\\heretic2.bmp
    
    - task:
        key: background
        name: set_regedit
        path: HKEY_CURRENT_USER\Control Panel\Colors\
        prefix: $GAMEDIR
        type: REG_SZ
        value: 0 0 0
    
    - task:
        key: ActiveTitle
        name: set_regedit
        path: HKEY_CURRENT_USER\Control Panel\Colors\
        prefix: $GAMEDIR
        type: REG_SZ
        value: 0 0 0
    
    - task:
        key: GradientActiveTitle
        name: set_regedit
        path: HKEY_CURRENT_USER\Control Panel\Colors\
        prefix: $GAMEDIR
        type: REG_SZ
        value: 204 153 255

    - execute:
        file: rm 
        args: -r $GAMEDIR/drive_c/tmp

