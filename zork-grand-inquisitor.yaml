name: Zork Grand Inquisitor
game_slug: zork-grand-inquisitor
version: Windows_Installer
slug:  zork_grand_inquisitor-installer
runner: scummvm


script:
  files:
    - patch: 
        url: https://drive.google.com/uc?export=download&id=1gfchx-coCOQhxlRL-WSdmoj6j5DgfRGX
        filename: patch.7z

  game:
      game_id: zgi-win
      path: $GAMEDIR

  installer:
      #setup wine and run installer, installer only uses disc1
      - task:
          name: wine.create_prefix
          prefix: $GAMEDIR
          arch: win32
          install_mono: false
          install_gecko: false
      
      - insert-disc:
          description: Please insert disc 1
          requires: setup.exe

      #set scummvm target and copy folders and files from disc 1,2
      - execute:
          args: $GAMEDIR/zassets1 $GAMEDIR/zassets2  $GAMEDIR/zgi_mx
          file: mkdir

      - copy:
          dst: $GAMEDIR/zassets1
          src: $DISC/zassets1
      - copy:
          dst: $GAMEDIR/zgi_mx
          src: $DISC/zgi/zgi_mx
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/cursor.zfs
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/death.zfs
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/inquis.str
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/inquis.zix
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/r.svr
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/scripts.zfs
      - copy:
          dst: $GAMEDIR
          src: $DISC/zgi/subtitle.zfs

      #remove readonly permission
      - execute:
          args: -R 775  "$GAMEDIR"
          file: chmod

      # execute install via wine
      - task:
          executable: $DISC/setup.exe
          arch: win32
          name: wine.wineexec
          prefix: $GAMEDIR

      # copy remaining files from disc 2
      - insert-disc:
          description: Please insert disc 2
          requires: zassets2

      - copy:
          dst: $GAMEDIR/zassets2
          src: $DISC/zassets2

      - execute:
          args: -R 775  "$GAMEDIR/zassets2"
          file: chmod

      # execute patch via wine
      - execute:
          file: 7z
          args: x $patch -o"$CACHE" -ppassword -y


      - task:
          executable: $CACHE/Zpatch.exe
          name: wine.wineexec
          arch: win32
          prefix: $GAMEDIR

      #copy patched files to scummvm target
      - copy:
          dst: $GAMEDIR/zgi_mx
          src: $GAMEDIR/drive_c/Program Files/Activision/ZGI/zgi_mx

      #working with case insentive on case senitive, great!
      - execute:
          args:  -r $GAMEDIR/inquis.str
          file: rm 
      - copy:
          dst: $GAMEDIR
          src: $GAMEDIR/drive_c/Program Files/Activision/ZGI/INQUIS.STR

      # folder and file clean up
      - execute:
          args: -rf $GAMEDIR/drive_c
          file: rm 

      - execute:
          args:  -r $GAMEDIR/dosdevices
          file: rm 

      - execute:
          args:  -r $GAMEDIR/system.reg
          file: rm 

      - execute:
          args:  -r $GAMEDIR/user.reg
          file: rm 

      - execute:
          args:  -r $GAMEDIR/userdef.reg
          file: rm 
          
  scummvm:
    fullscreen: true
