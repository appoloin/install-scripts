name: Quake II
game_slug: quake-ii
version: Installer
slug:  installer
runner: linux


script:
    files:
        - game: N/A:Select Setup.exe
        - engine: https://lutris.nyc3.digitaloceanspaces.com/games/quake-2/yamagi-yquake2-7.30-x86_64.tar.gz
        - quakepatch: https://deponie.yamagi.org/quake2/idstuff/q2-3.20-x86-full-ctf.exe   

    game:
        exe: quake2

    installer:        
        - write_file:
            content: '#!/bin/bash

              src=$1
      
              dst=$2

              echo $dst

              find "$src" -maxdepth 1 -type f -iname "*.ogg" -print0 | 

                  while IFS="" read -r -d "" FILENAME; 

                      do mv "$FILENAME" "${dst}""/""${FILENAME##*/*[Tt][Rr][Aa][cC][kK]}";

                  done'
            file: $CACHE/copyrename.sh
        - chmodx: $CACHE/copyrename.sh        
        
        - extract:
            format: gog
            file: $game
            args: --gog
            dst: $GAMEDIR
            description: Extracting game files

        - execute:
            args: $CACHE/patch 
            file: mkdir

        - extract:
            dst:  $CACHE/patch
            file: $quakepatch
            format: zip
        
        - merge:
            src: "$CACHE/patch/baseq2"
            dst: "$GAMEDIR/baseq2"

        - merge:
            src: "$CACHE/patch/ctf"
            dst: "$GAMEDIR/ctf"

        - extract:
            file: $engine
            dst: $GAMEDIR